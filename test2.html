<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prayer Times – Gosheim, Germany</title>
  <meta name="theme-color" content="#0b0f14" />
  <style>
    :root {
      --bg:#0b0f14; --card:#111722; --text:#e6edf3; --muted:#9fb0c0;
      --accent:#3aa3ff; --accent2:#25c2a0; --border:#233044; --radius:12px;
      --shadow:0 6px 18px rgba(0,0,0,0.35);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .app{max-width:820px;margin:0 auto;padding:14px 18px 28px}

    header{position:sticky;top:0;z-index:1000;background:var(--card);border-bottom:1px solid var(--border);box-shadow:var(--shadow);padding:12px;text-align:left}
    header h1{margin:0;font-size:1rem}
    header .sub{margin-top:6px;font-size:0.92rem;color:var(--muted)}

    .error{display:none;color:#ff788a;background:rgba(255,77,109,0.12);border:1px solid #ff4d6d;border-radius:10px;padding:8px;margin:10px 0;text-align:center;font-size:0.9rem}

    /* Date navigation */
    .date-nav{display:flex;align-items:center;gap:8px;justify-content:center;margin:12px 0}
    .date-nav button{
      background:var(--card);color:var(--text);border:1px solid var(--border);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:600;
      box-shadow:var(--shadow);
    }
    .date-nav button:active{transform:scale(0.97)}
    .date-nav input[type="date"]{background:var(--card);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px;font-size:0.95rem}

    /* NEXT PRAYER ROW FIXED */
    .next-row{
      display:flex;justify-content:space-between;align-items:center;
      background:var(--card);border:1px solid var(--border);
      border-radius:var(--radius);padding:12px;margin-bottom:12px;
      box-shadow:var(--shadow);
    }
    .next-left{text-align:left}
    .next-right{text-align:right}

    .label{font-size:0.85rem;color:var(--muted)}
    .value{font-size:1rem;font-weight:700}

    table{width:100%;border-collapse:collapse;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:14px;overflow:hidden}
    th,td{padding:10px;border-bottom:1px solid var(--border);text-align:center;font-size:0.9rem}
    th{color:var(--muted);background:#0f1623}
    tr:last-child td{border-bottom:none}
    .row.current td:nth-child(2){color:var(--accent);font-weight:700;background:rgba(58,163,255,0.08)}
    .row.next td:nth-child(2){color:var(--accent2);font-weight:700;background:rgba(37,194,160,0.08)}
    .indicator{display:block;font-size:0.72rem;margin-top:4px;color:var(--muted)}

    .ramadan-widget{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:12px;margin-top:14px;text-align:center;box-shadow:var(--shadow)}
    .ramadan-widget strong{color:var(--accent2)}
    .ramadan-widget .sub{color:var(--muted);font-size:0.9rem}

    .calendar-toggle{text-align:center;margin:12px 0}
    .calendar-toggle button{
      background:var(--card);color:var(--text);
      border:2px solid var(--accent);border-radius:var(--radius);
      padding:10px 18px;cursor:pointer;font-size:0.95rem;font-weight:600;
      box-shadow:var(--shadow);
    }

    .calendar-container{display:none;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:12px;margin-top:16px;box-shadow:var(--shadow);max-height:460px;overflow:auto}
    .calendar-header{display:flex;gap:6px;align-items:center;justify-content:center;margin-bottom:10px}

    /* Selects without labels (mobile clean) */
    .calendar-header select{
      background:transparent;color:var(--text);border:1px solid var(--border);
      padding:8px;border-radius:8px;font-size:0.9rem;
    }

    /* REFRESH BUTTON */
    #loadMonthBtn{
      background:var(--card);border:1px solid var(--border);
      padding:8px 10px;border-radius:50%;cursor:pointer;
      font-size:1.1rem;line-height:1;box-shadow:var(--shadow);
    }

    .calendar-container h2{text-align:center;font-size:0.95rem;margin:0 0 8px;color:var(--accent)}
    .calendar-table{width:100%;border-collapse:collapse}
    .calendar-table th,.calendar-table td{padding:8px;border-bottom:1px solid var(--border);font-size:0.85rem;text-align:center}
    .calendar-table th{color:var(--muted);background:#0f1623}
    tr:last-child td{border-bottom:none}
    .cal-today{background:rgba(58,163,255,0.12)}

    .calendar-legend{text-align:center;color:var(--muted);font-size:0.78rem;margin-top:8px}

    footer{text-align:center;margin-top:16px;padding-bottom:8px}
    footer .powered{font-size:0.7rem;color:var(--muted)}
    footer .meta{font-size:0.6rem;color:#6b7890;margin-top:6px}

    /* MOBILE FIRST */
    @media(max-width:520px) {
      .next-row{padding:10px}
      .value{font-size:0.95rem}
      .calendar-header{gap:4px}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Prayer times for Gosheim, Germany</h1>
      <div class="sub" id="gregorian">—</div>
      <div class="sub" id="hijri">—</div>
    </header>

    <div id="error" class="error"></div>

    <div class="date-nav">
      <button id="prevDay">&larr;</button>
      <input type="date" id="dateInput" />
      <button id="nextDay">&rarr;</button>
    </div>

    <!-- FIXED ALIGNMENT -->
    <div class="next-row">
      <div class="next-left">
        <span class="label">Next Prayer</span>
        <div class="value" id="nextName">—</div>
      </div>
      <div class="next-right">
        <span class="label">Countdown</span>
        <div class="value" id="countdown">—</div>
      </div>
    </div>

    <table>
      <thead><tr><th>Prayer</th><th>Time</th></tr></thead>
      <tbody id="tableBody"></tbody>
    </table>

    <div class="ramadan-widget">
      <div><strong>Days until Ramadan:</strong> <span id="ramadanCountdown">—</span></div>
      <div class="sub" id="ramadanDate">—</div>
    </div>

    <div class="calendar-toggle">
      <button id="toggleCalendar">Show Monthly Calendar</button>
    </div>

    <div class="calendar-container" id="calendarContainer">
      <h2>Monthly Prayer Calendar</h2>

      <div class="calendar-header">
        <select id="monthSelect"></select>
        <select id="yearSelect"></select>

        <!-- Small icon button ➜ refresh -->
        <button id="loadMonthBtn" title="Reload">&#10227;</button>
      </div>

      <table class="calendar-table">
        <thead>
          <tr><th>Date</th><th>Fajr</th><th>Dhuhr</th><th>Asr</th><th>Maghrib</th><th>Isha</th></tr>
        </thead>
        <tbody id="calendarBody"></tbody>
      </table>

      <div class="calendar-legend">Times shown in 12-hour format (AM/PM omitted)</div>
    </div>

    <footer>
      <div class="powered">Powered by AlAdhan API</div>
      <div class="meta" id="meta">Method: Muslim World League · Hanafi</div>
    </footer>
  </div>

  <script>
    /* ------- JS unchanged from previous full version except minor UI tweaks ------- */
    /* Only removing label refs & adding icon reload */

    const ADDRESS = "Gosheim, Germany";
    const METHOD = "3";
    const SCHOOL = "1";
    const PRAYER_ORDER = ["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];
    const PRAYERS_FOR_STATUS = ["Fajr","Dhuhr","Asr","Maghrib","Isha"];

    const el = {
      tableBody: document.getElementById("tableBody"),
      gregorian: document.getElementById("gregorian"),
      hijri: document.getElementById("hijri"),
      nextName: document.getElementById("nextName"),
      countdown: document.getElementById("countdown"),
      dateInput: document.getElementById("dateInput"),
      ramadanCountdown: document.getElementById("ramadanCountdown"),
      ramadanDate: document.getElementById("ramadanDate"),
      meta: document.getElementById("meta"),
      error: document.getElementById("error"),
      toggleBtn: document.getElementById("toggleCalendar"),
      calContainer: document.getElementById("calendarContainer"),
      monthSelect: document.getElementById("monthSelect"),
      yearSelect: document.getElementById("yearSelect"),
      loadMonthBtn: document.getElementById("loadMonthBtn"),
      calendarBody: document.getElementById("calendarBody"),
      prevDay: document.getElementById("prevDay"),
      nextDay: document.getElementById("nextDay"),
    };

    const pad = n => String(n).padStart(2,"0");
    const formatAPIDate = d => `${pad(d.getDate())}-${pad(d.getMonth()+1)}-${d.getFullYear()}`;
    const formatInputDate = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    const stripTZ = s => s.split(" ")[0];

    function toAmPm(t){
      if(!t) return "—";
      let [h,m] = t.split(":");
      h = parseInt(h,10);
      const suf = h>=12 ? "PM" : "AM";
      h = h % 12; if(h===0) h = 12;
      return `${h}:${m} ${suf}`;
    }
    function to12NoSuffix(t){
      if(!t) return "—";
      let [h,m] = t.split(":");
      h = parseInt(h,10);
      h = h % 12; if(h === 0) h = 12;
      return `${h}:${m}`;
    }

    function parseTime(base,t){
      const d = new Date(base);
      const [h,m] = t.split(":");
      d.setHours(+h,+m,0,0);
      return d;
    }

    function buildRow(name,time24,isCurrent,isNext){
      const tr = document.createElement("tr");
      tr.className = (isCurrent?"row current":"row") + (isNext?" next":"");
      const td1 = document.createElement("td"); td1.textContent = name;
      const td2 = document.createElement("td"); td2.textContent = toAmPm(time24);
      if(isCurrent) td2.innerHTML += `<span class="indicator">Current</span>`;
      if(isNext) td2.innerHTML += `<span class="indicator">Next</span>`;
      tr.append(td1,td2);
      return tr;
    }

    let timer = null;

    async function loadDaily(date){
      try{
        el.error.style.display = "none";
        const r = await fetch(`https://api.aladhan.com/v1/timingsByAddress/${formatAPIDate(date)}?address=${ADDRESS}&method=${METHOD}&school=${SCHOOL}`);
        const data = (await r.json()).data;
        const t = data.timings;
        const h = data.date.hijri;

        el.gregorian.textContent = data.date.readable;
        el.hijri.textContent = `Hijri: ${h.day} ${h.month.en} ${h.year}`;

        const tMap={};
        PRAYER_ORDER.forEach(p=>{
          const t24 = stripTZ(t[p]);
          if(t24) tMap[p] = parseTime(date,t24);
        });

        let current=null,next=null;
        const now = new Date();
        for(const p of PRAYERS_FOR_STATUS){
          const tt = tMap[p]; if(!tt) continue;
          if(now >= tt) current = p;
          else if(!next) next = p;
        }

        el.tableBody.innerHTML="";
        PRAYER_ORDER.forEach(p=>{
          const t24 = stripTZ(t[p]);
          if(t24) el.tableBody.appendChild(buildRow(p,t24,p===current,p===next));
        });

        if(timer) clearInterval(timer);
        if(next){
          el.nextName.textContent = next;
          const target = tMap[next];
          const tick = ()=>{
            const diff = target - new Date();
            if(diff<=0){ el.countdown.textContent="00:00:00"; clearInterval(timer);}
            else{
              const s = Math.floor(diff/1000);
              const h = Math.floor(s/3600);
              const m = Math.floor((s%3600)/60);
              const ss = s%60;
              el.countdown.textContent = `${pad(h)}:${pad(m)}:${pad(ss)}`;
            }
          };
          tick();
          timer=setInterval(tick,1000);
        } else {
          el.nextName.textContent="—";
          el.countdown.textContent="—";
        }

      }catch(e){
        el.error.textContent = "Error loading prayer times";
        el.error.style.display="block";
      }
    }

    async function loadMonthly(month,year,highlight){
      try{
        el.calendarBody.innerHTML="";
        const r = await fetch(`https://api.aladhan.com/v1/calendarByAddress?address=${ADDRESS}&month=${month}&year=${year}&method=${METHOD}&school=${SCHOOL}`);
        const data = (await r.json()).data;

        const highlightStr = highlight ? `${pad(highlight)}-${pad(month)}-${year}` : null;

        data.forEach(d=>{
          const gr = d.date.gregorian.date;
          const row = document.createElement("tr");
          if(gr === highlightStr) row.classList.add("cal-today");
          const cells = [
            d.date.readable,
            to12NoSuffix(stripTZ(d.timings.Fajr)),
            to12NoSuffix(stripTZ(d.timings.Dhuhr)),
            to12NoSuffix(stripTZ(d.timings.Asr)),
            to12NoSuffix(stripTZ(d.timings.Maghrib)),
            to12NoSuffix(stripTZ(d.timings.Isha)),
          ];
          cells.forEach(v=>{
            const td=document.createElement("td"); td.textContent=v; row.appendChild(td);
          });
          el.calendarBody.appendChild(row);
        });

      }catch(e){
        el.calendarBody.innerHTML="<tr><td colspan='6'>Unable to load calendar</td></tr>";
      }
    }

    function initMonthYear(date){
      const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
      el.monthSelect.innerHTML="";
      months.forEach((m,i)=>{
        const op=document.createElement("option");
        op.value=i+1; op.textContent=m;
        el.monthSelect.appendChild(op);
      });
      el.yearSelect.innerHTML="";
      const yr=date.getFullYear();
      for(let y=yr-2;y<=yr+2;y++){
        const op=document.createElement("option");
        op.value=y; op.textContent=y;
        el.yearSelect.appendChild(op);
      }
      el.monthSelect.value = date.getMonth()+1;
      el.yearSelect.value = date.getFullYear();
    }

    el.toggleBtn.onclick = ()=>{
      const show = el.calContainer.style.display !== "block";
      el.calContainer.style.display = show?"block":"none";
      el.toggleBtn.textContent = show ? "Hide Monthly Calendar" : "Show Monthly Calendar";

      if(show){
        const d = new Date(el.dateInput.value);
        loadMonthly(+el.monthSelect.value,+el.yearSelect.value,d.getDate());
      }
    };

    el.loadMonthBtn.onclick = ()=>{
      const d = new Date(el.dateInput.value);
      loadMonthly(+el.monthSelect.value,+el.yearSelect.value,d.getMonth()+1===+el.monthSelect.value?d.getDate():null);
    };

    el.prevDay.onclick = ()=> {
      const d = new Date(el.dateInput.value); d.setDate(d.getDate()-1);
      el.dateInput.value = formatInputDate(d); loadDaily(d);
    };
    el.nextDay.onclick = ()=> {
      const d = new Date(el.dateInput.value); d.setDate(d.getDate()+1);
      el.dateInput.value = formatInputDate(d); loadDaily(d);
    };

    el.dateInput.onchange = ()=>{
      const d = new Date(el.dateInput.value);
      loadDaily(d);
    };

    (function init(){
      const today = new Date();
      el.dateInput.value = formatInputDate(today);
      initMonthYear(today);
      loadDaily(today);
      loadMonthly(today.getMonth()+1,today.getFullYear(),today.getDate());
    })();
  </script>
</body>
</html>