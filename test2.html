<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Prayer Times</title>

<style>
  :root {
    --bg: #f0f0f0;
    --card: #ffffff;
    --border: #dddddd;
    --text: #333333;
    --accent: #2b7cff;
    --shadow: 0 2px 6px rgba(0,0,0,0.12);
  }

  body {
    background: var(--bg);
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    color: var(--text);
  }

  h1 {
    text-align: center;
    margin-bottom: 20px;
  }

  .container {
    max-width: 900px;
    margin: auto;
  }

  /* DAILY CARD */
  .card {
    background: var(--card);
    padding: 20px;
    border-radius: 12px;
    box-shadow: var(--shadow);
    margin-bottom: 20px;
  }

  .date-nav {
    display: flex;
    justify-content: center;
    margin-bottom: 15px;
    align-items: center;
    gap: 10px;
  }

  .date-nav button {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 7px 12px;
    cursor: pointer;
    font-size: 1rem;
    box-shadow: var(--shadow);
  }

  .date-nav button:hover {
    background: var(--accent);
    color: #fff;
  }

  .day-times {
    width: 100%;
    border-collapse: collapse;
  }

  .day-times td {
    padding: 10px;
    border-bottom: 1px solid var(--border);
  }

  /* MONTHLY */
  .calendar-controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  select {
    padding: 8px;
    border-radius: 8px;
    border: 1px solid var(--border);
  }

  #calendarWrapper {
    margin-top: 15px;
    display: none; /* Hidden initially */
  }

  .month-table {
    width: 100%;
    border-collapse: collapse;
    box-shadow: var(--shadow);
    border-radius: 12px;
    overflow: hidden;
  }

  .month-table th, .month-table td {
    padding: 10px;
    border: 1px solid var(--border);
    text-align: center;
  }

  .legend {
    margin-top: 10px;
    font-size: 0.9rem;
    color: #555;
    text-align: center;
  }

  /* TOGGLE BUTTON */
  #toggleCalendar {
    display: block;
    margin: 0 auto 20px auto;
    padding: 10px 15px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: var(--shadow);
    font-size: 1rem;
  }

  #toggleCalendar:hover {
    background: #1a5ed7;
  }
</style>
</head>

<body>
<div class="container">

  <h1>Prayer Times</h1>

  <!-- DAILY CARD -->
  <div class="card">
    <div class="date-nav">
      <button id="prevDay">←</button>
      <input type="date" id="dateInput">
      <button id="nextDay">→</button>
    </div>

    <table class="day-times" id="dailyTable">
      <tbody></tbody>
    </table>
  </div>

  <!-- MONTHLY TOGGLE -->
  <button id="toggleCalendar">Show Monthly Calendar</button>

  <!-- MONTHLY SECTION -->
  <div id="calendarWrapper">
    <div class="calendar-controls">
      <select id="monthSelect"></select>
      <select id="yearSelect"></select>
    </div>

    <table class="month-table" id="monthlyTable"></table>

    <div class="legend">Times shown are in 12-hour format.</div>
  </div>

</div>

<script>
  /* ------------------------
       ELEMENT SHORTCUTS
  ------------------------- */
  const el = {
    dateInput: document.getElementById("dateInput"),
    prevDay: document.getElementById("prevDay"),
    nextDay: document.getElementById("nextDay"),
    dailyTable: document.getElementById("dailyTable").querySelector("tbody"),
    monthSelect: document.getElementById("monthSelect"),
    yearSelect: document.getElementById("yearSelect"),
    calendarWrapper: document.getElementById("calendarWrapper"),
    toggleCalendar: document.getElementById("toggleCalendar"),
    monthlyTable: document.getElementById("monthlyTable")
  };

  /* ------------------------
        HELPER FUNCTIONS
  ------------------------- */
  const formatInputDate = d =>
    d.toISOString().split("T")[0];

  const to12h = timeStr => {
    const [h, m] = timeStr.split(":").map(Number);
    const suffix = h >= 12 ? "PM" : "AM";
    const hh = ((h + 11) % 12 + 1);
    return `${hh}:${m.toString().padStart(2,"0")} ${suffix}`;
  };

  /* ------------------------
        LOAD DAILY TIMES
  ------------------------- */
  async function loadDaily(dateObj) {
    const dateStr = formatInputDate(dateObj);

    const res = await fetch(`/today-times?date=${dateStr}`);
    const times = await res.json();

    el.dailyTable.innerHTML = `
      <tr><td>Fajr</td><td>${to12h(times.fajr)}</td></tr>
      <tr><td>Dhuhr</td><td>${to12h(times.dhuhr)}</td></tr>
      <tr><td>Asr</td><td>${to12h(times.asr)}</td></tr>
      <tr><td>Maghrib</td><td>${to12h(times.maghrib)}</td></tr>
      <tr><td>Isha</td><td>${to12h(times.isha)}</td></tr>
    `;
  }

  /* ------------------------
        LOAD MONTHLY TABLE
  ------------------------- */
  async function loadMonthly(dateObj) {
    const year = dateObj.getFullYear();
    const month = dateObj.getMonth() + 1;

    const res = await fetch(`/month-times?year=${year}&month=${month}`);
    const data = await res.json();

    // Build table
    let html = `
      <tr>
        <th>Date</th>
        <th>Fajr</th>
        <th>Dhuhr</th>
        <th>Asr</th>
        <th>Maghrib</th>
        <th>Isha</th>
      </tr>
    `;

    data.forEach(row => {
      html += `
        <tr>
          <td>${row.date}</td>
          <td>${row.fajr.split(" ")[0]}</td>
          <td>${row.dhuhr.split(" ")[0]}</td>
          <td>${row.asr.split(" ")[0]}</td>
          <td>${row.maghrib.split(" ")[0]}</td>
          <td>${row.isha.split(" ")[0]}</td>
        </tr>
      `;
    });

    el.monthlyTable.innerHTML = html;
  }

  /* ------------------------
        DATE NAV BUTTONS
  ------------------------- */
  el.prevDay.addEventListener("click", () => {
    const d = new Date(el.dateInput.value);
    d.setDate(d.getDate() - 1);
    el.dateInput.value = formatInputDate(d);
    loadDaily(d);
  });

  el.nextDay.addEventListener("click", () => {
    const d = new Date(el.dateInput.value);
    d.setDate(d.getDate() + 1);
    el.dateInput.value = formatInputDate(d);
    loadDaily(d);
  });

  /* ------------------------
        CALENDAR TOGGLE
  ------------------------- */
  el.toggleCalendar.addEventListener("click", () => {
    const isOpen = el.calendarWrapper.style.display === "block";
    el.calendarWrapper.style.display = isOpen ? "none" : "block";
    el.toggleCalendar.textContent = isOpen ? "Show Monthly Calendar" : "Hide Monthly Calendar";
  });

  /* ------------------------
        MONTH/YEAR CHANGE
  ------------------------- */
  el.monthSelect.addEventListener("change", () => {
    const y = parseInt(el.yearSelect.value);
    const m = parseInt(el.monthSelect.value);
    loadMonthly(new Date(y, m - 1, 1));
  });

  el.yearSelect.addEventListener("change", () => {
    const y = parseInt(el.yearSelect.value);
    const m = parseInt(el.monthSelect.value);
    loadMonthly(new Date(y, m - 1, 1));
  });

  /* ------------------------
        INITIAL SETUP
  ------------------------- */
  (function init() {
    const today = new Date();
    el.dateInput.value = formatInputDate(today);

    // Populate month dropdown
    const months = ["January","February","March","April","May","June",
                    "July","August","September","October","November","December"];

    months.forEach((m,i) => {
      const opt = document.createElement("option");
      opt.value = i + 1;
      opt.textContent = m;
      el.monthSelect.appendChild(opt);
    });

    // Populate years
    const year = today.getFullYear();
    for(let y = year - 5; y <= year + 5; y++){
      const opt = document.createElement("option");
      opt.value = y;
      opt.textContent = y;
      el.yearSelect.appendChild(opt);
    }

    el.monthSelect.value = today.getMonth() + 1;
    el.yearSelect.value = today.getFullYear();

    loadDaily(today);
    loadMonthly(today);
  })();
</script>

</body>
</html>