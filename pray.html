<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Prayer Times – Gosheim</title>
  <style>
    /* Dark mode variables */
    :root {
      --bg: #0b0f14;
      --card: #111722;
      --text: #e6edf3;
      --muted: #9fb0c0;
      --accent: #3aa3ff;
      --accent-2: #25c2a0;
      --border: #233044;
      --shadow: 0 8px 24px rgba(0,0,0,0.35);
      --radius: 14px;
    }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 0;
    }
    .app { max-width: 680px; margin: 0 auto; padding: 16px; }
    header { margin-bottom: 12px; }
    h1 { font-size: 1.25rem; margin: 0; }
    .sub { color: var(--muted); font-size: 0.9rem; }

    table {
      width: 100%; border-collapse: collapse;
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
      margin-bottom: 16px;
    }
    th, td { padding: 12px; border-bottom: 1px solid var(--border); text-align: center; }
    th { color: var(--muted); font-size: 0.9rem; }
    tr:last-child td { border-bottom: none; }
    .row.current td:nth-child(2) { color: var(--accent); font-weight: 700; }
    .row.next td:nth-child(2) { color: var(--accent-2); font-weight: 700; }
    .indicator { display: block; font-size: 0.75rem; margin-top: 4px; }

    .countdown {
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 14px; margin-bottom: 16px;
      text-align: center;
    }
    .settings {
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 12px; box-shadow: var(--shadow);
      display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
    }
    .settings label { color: var(--muted); font-size: 0.85rem; }
    .settings select {
      background: transparent; color: var(--text);
      border: 1px solid var(--border); border-radius: 10px; padding: 10px;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Prayer times for Gosheim, Germany</h1>
      <div class="sub" id="gregorian"></div>
    </header>

    <!-- Table first -->
    <table>
      <thead>
        <tr>
          <th>Prayer</th>
          <th>Time & Status</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <!-- Countdown -->
    <div class="countdown">
      <div><strong>Next prayer:</strong> <span id="nextName">—</span></div>
      <div><strong>Time remaining:</strong> <span id="countdown">—</span></div>
    </div>

    <!-- Settings at bottom -->
    <section class="settings">
      <div>
        <label for="methodSelect">Calculation method</label>
        <select id="methodSelect">
          <option value="3" selected>Muslim World League</option>
          <option value="2">Egyptian General Authority</option>
          <option value="1">Karachi</option>
          <option value="4">Umm al-Qura</option>
        </select>
      </div>
      <div>
        <label for="schoolSelect">Juristic school</label>
        <select id="schoolSelect">
          <option value="1" selected>Hanafi</option>
          <option value="0">Shafi</option>
        </select>
      </div>
    </section>
  </div>

  <script>
    const ADDRESS = "Gosheim, Germany";
    const PRAYER_ORDER = ["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];
    const el = {
      tableBody: document.getElementById("tableBody"),
      gregorian: document.getElementById("gregorian"),
      nextName: document.getElementById("nextName"),
      countdown: document.getElementById("countdown"),
      methodSelect: document.getElementById("methodSelect"),
      schoolSelect: document.getElementById("schoolSelect"),
    };

    function pad(n){ return String(n).padStart(2,"0"); }
    function formatAPIDate(d){ return `${pad(d.getDate())}-${pad(d.getMonth()+1)}-${d.getFullYear()}`; }

    function parseTime(baseDate, timeStr){
      const [hh,mm] = timeStr.split(":").map(Number);
      const d = new Date(baseDate); d.setHours(hh,mm,0,0); return d;
    }

    function hms(ms){
      if(ms<0) ms=0;
      const s=Math.floor(ms/1000);
      const hh=Math.floor(s/3600), mm=Math.floor((s%3600)/60), ss=s%60;
      return `${pad(hh)}:${pad(mm)}:${pad(ss)}`;
    }

    async function loadTimings(){
      const date=new Date();
      const apiDate=formatAPIDate(date);
      const url=`https://api.aladhan.com/v1/timingsByAddress/${apiDate}?address=${encodeURIComponent(ADDRESS)}&method=${el.methodSelect.value}&school=${el.schoolSelect.value}`;
      const res=await fetch(url);
      const data=await res.json();
      const timings=data.data.timings;
      const prayerTimes={};
      PRAYER_ORDER.forEach(p=>{ prayerTimes[p]=parseTime(date,timings[p]); });

      // Determine current/next
      const now=new Date();
      let current=null,next=null;
      ["Fajr","Dhuhr","Asr","Maghrib","Isha"].forEach(p=>{
        if(now>=prayerTimes[p]) current=p;
        else if(!next) next=p;
      });

      el.tableBody.innerHTML="";
      PRAYER_ORDER.forEach(p=>{
        const tr=document.createElement("tr");
        tr.className="row";
        if(p===current) tr.classList.add("current");
        if(p===next) tr.classList.add("next");
        const td1=document.createElement("td"); td1.textContent=p;
        const td2=document.createElement("td");
        td2.textContent=timings[p];
        if(p===current) td2.innerHTML+=`<span class="indicator">Current</span>`;
        if(p===next) td2.innerHTML+=`<span class="indicator">Next</span>`;
        tr.appendChild(td1); tr.appendChild(td2);
        el.tableBody.appendChild(tr);
      });

      if(next){
        el.nextName.textContent=next;
        const tick=()=>{ el.countdown.textContent=hms(prayerTimes[next]-new Date()); };
        tick(); setInterval(tick,1000);
      }
      el.gregorian.textContent=data.data.date.readable;
    }

    loadTimings();
  </script>
</body>
</html>
