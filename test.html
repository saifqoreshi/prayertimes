<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Gebetszeiten Gosheim</title>
<style>
  body { font-family: Arial, sans-serif; background:#0f172a; color:#e5e7eb; margin:0; padding:16px; }
  h1 { font-size:1.2rem; margin:0 0 8px; }
  table { width:100%; border-collapse:collapse; margin-bottom:12px; }
  th, td { padding:6px; text-align:left; font-size:0.9rem; }
  th { border-bottom:1px solid #1f2937; }
  tr:nth-child(even){background:#111827;}
  .status { font-size:0.7rem; padding:2px 6px; border-radius:6px; }
  .now { background:#f59e0b33; color:#f59e0b; }
  .next { background:#22c55e33; color:#22c55e; }
  .card { background:#111827; padding:10px; border-radius:8px; margin-bottom:12px; }
  .count { font-size:1rem; font-weight:bold; }
  .controls { margin:8px 0; }
  .btn { background:#1f2937; color:#e5e7eb; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:0.8rem; }
  .btn:hover { background:#374151; }
  .footer { font-size:0.7rem; color:#9ca3af; margin-top:8px; }
</style>
</head>
<body>
  <h1>Gebetszeiten Gosheim</h1>
  <table id="prayerTable">
    <thead><tr><th>Gebet</th><th>Zeit</th><th>Status</th></tr></thead>
    <tbody></tbody>
  </table>

  <div class="card">
    <div><b>Nächstes Gebet:</b> <span id="nextName">–</span></div>
    <div><b>Zeit:</b> <span id="nextTime">–</span></div>
    <div><b>Countdown:</b> <span id="countdown" class="count">–</span></div>
  </div>

  <div class="controls">
    <button class="btn" id="prevBtn">← Vorher</button>
    <button class="btn" id="todayBtn">Heute</button>
    <button class="btn" id="nextBtn">Nächster →</button>
  </div>

  <div class="card">
    <div><b>Datum:</b> <span id="gregDate">–</span> | <b>Hijri:</b> <span id="hijriDate">–</span></div>
  </div>

  <div class="footer" id="settingsLine">–</div>

<script>
const CITY="Gosheim", COUNTRY="Germany", METHOD=3, SCHOOL=1;
let dayOffset=0, countdownTimer=null;

function pad2(n){return String(n).padStart(2,"0");}
function addDays(d,n){let x=new Date(d);x.setDate(x.getDate()+n);return x;}
function fmtDate(d){return new Intl.DateTimeFormat("de-DE",{weekday:"short",day:"2-digit",month:"2-digit",year:"numeric"}).format(d);}
function fmtTime(d){return new Intl.DateTimeFormat("de-DE",{hour:"2-digit",minute:"2-digit"}).format(d);}

async function fetchData(offset){
  const base=addDays(new Date(),offset);
  const dd=pad2(base.getDate()), mm=pad2(base.getMonth()+1), yyyy=base.getFullYear();
  const url=`https://api.aladhan.com/v1/timingsByCity?city=${CITY}&country=${COUNTRY}&method=${METHOD}&school=${SCHOOL}&date=${dd}-${mm}-${yyyy}`;
  const res=await fetch(url); const j=await res.json(); return j.data;
}

function render(data){
  document.getElementById("gregDate").textContent=fmtDate(addDays(new Date(),dayOffset));
  document.getElementById("hijriDate").textContent=`${data.date.hijri.day}.${data.date.hijri.month.ar} ${data.date.hijri.year}`;
  document.getElementById("settingsLine").textContent=`Methode: Muslim World League | Schule: Hanafi | Stadt: ${CITY} | TZ: ${data.meta.timezone}`;

  const tbody=document.querySelector("#prayerTable tbody"); tbody.innerHTML="";
  const keys=["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];
  const now=new Date();
  const entries=keys.map(k=>{
    const [h,m]=data.timings[k].split(":").map(Number);
    const d=addDays(new Date(),dayOffset); d.setHours(h,m,0,0);
    return {key:k,time:fmtTime(d),when:d};
  });
  let current=-1,next=-1;
  for(let i=0;i<entries.length;i++){if(now>=entries[i].when && (!entries[i+1]||now<entries[i+1].when)){current=i;next=i+1;break;}}
  if(current===-1) next=entries.findIndex(e=>e.when>now);

  entries.forEach((e,i)=>{
    let status=""; if(i===current)status="now"; else if(i===next)status="next";
    tbody.innerHTML+=`<tr><td>${e.key}</td><td>${e.time}</td><td>${status?'<span class="status '+status+'">'+(status==="now"?"aktuell":"nächstes")+'</span>':""}</td></tr>`;
  });

  const nextEl=next>=0?entries[next]:null;
  document.getElementById("nextName").textContent=nextEl?nextEl.key:"–";
  document.getElementById("nextTime").textContent=nextEl?nextEl.time:"–";
  if(countdownTimer)clearInterval(countdownTimer);
  if(nextEl){
    function tick(){
      const diff=nextEl.when-new Date();
      if(diff<=0){document.getElementById("countdown").textContent="00:00:00";return;}
      const s=Math.floor(diff/1000),h=pad2(Math.floor(s/3600)),m=pad2(Math.floor((s%3600)/60)),sec=pad2(s%60);
      document.getElementById("countdown").textContent=`${h}:${m}:${sec}`;
    }
    tick(); countdownTimer=setInterval(tick,1000);
  } else document.getElementById("countdown").textContent="–";
}

async function refresh(){const d=await fetchData(dayOffset);render(d);}
document.getElementById("prevBtn").onclick=()=>{dayOffset--;refresh();};
document.getElementById("nextBtn").onclick=()=>{dayOffset++;refresh();};
document.getElementById("todayBtn").onclick=()=>{dayOffset=0;refresh();};
refresh();
</script>
</body>
</html>
