<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Prayer Times — Gosheim (OLED)</title>
<style>
  :root{
    --black:#000000;               /* true OLED black */
    --card:#070708;                /* very dark card */
    --muted:#7f98a8;               /* soft muted */
    --text:#e6f3fb;                /* pale text */
    --accent:#2dd4ff;              /* cool cyan accent */
    --accent2:#00d7a7;             /* secondary accent */
    --glass: rgba(255,255,255,0.03);
    --border: rgba(255,255,255,0.06);
    --radius:10px;
    --shadow: 0 8px 24px rgba(0,0,0,0.6);
    --compact-gap:8px;
    --small:0.82rem;
    --base: 14px;
  }
  /* Basic reset */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:var(--black);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    line-height:1.25;
    font-size:var(--base);
    padding:18px;
  }

  /* Container: centered, compact width */
  .wrap{
    max-width:820px;
    margin:0 auto;
    display:grid;
    grid-template-columns: 1fr 320px;
    gap:18px;
    align-items:start;
  }

  /* Header */
  header{
    grid-column:1 / -1;
    background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    border:1px solid var(--border);
    padding:14px 16px;
    border-radius:calc(var(--radius) + 2px);
    display:flex;
    gap:12px;
    align-items:center;
    box-shadow:var(--shadow);
  }
  header .brand{
    display:flex;
    gap:12px;
    align-items:center;
  }
  .logo{
    width:46px;height:46px;border-radius:10px;
    background:linear-gradient(135deg, rgba(45,212,255,0.14), rgba(0,215,167,0.08));
    display:grid;place-items:center;border:1px solid rgba(255,255,255,0.03);
    font-weight:700;color:var(--accent);
    font-size:1.05rem;
  }
  header h1{
    margin:0;font-size:0.98rem;letter-spacing:0.2px;
    font-weight:600;
  }
  header .sub{color:var(--muted);font-size:var(--small);margin-top:4px;}

  /* Main card (left) */
  .main{
    background:var(--card);
    border-radius:var(--radius);
    border:1px solid var(--border);
    padding:12px;
    box-shadow:var(--shadow);
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .toprow{
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
  }
  .next-prayer-card{
    flex:1;
    background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.004));
    border-radius:10px;padding:10px;border:1px solid rgba(255,255,255,0.03);
    display:flex;flex-direction:column;gap:6px;
  }
  .label{font-size:0.78rem;color:var(--muted);letter-spacing:0.3px}
  .next-name{font-size:1.05rem;font-weight:700;color:var(--accent);line-height:1;}
  .countdown{font-weight:700;font-size:1rem;color:var(--text);}

  /* Date navigation small and compact */
  .date-nav{
    display:flex;gap:8px;align-items:center;
  }
  .icon-btn{
    background:transparent;border:1px solid var(--border);
    color:var(--text);padding:8px;border-radius:8px;cursor:pointer;
    min-width:42px;display:inline-grid;place-items:center;
  }
  input[type="date"]{
    background:transparent;border:1px solid var(--border);
    color:var(--text);padding:8px 10px;border-radius:8px;text-align:center;
  }

  /* Prayer table compact */
  table.prayers{
    width:100%;border-collapse:collapse;font-size:0.93rem;
    background:transparent;
  }
  th,td{padding:8px 10px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03)}
  thead th{color:var(--muted);font-size:0.78rem}
  tbody tr:last-child td{border-bottom:none}
  .time{
    font-weight:700;color:var(--text);float:right;
  }
  .current .time{color:var(--accent);font-weight:800}
  .next .time{color:var(--accent2);font-weight:800}
  .indicator{display:inline-block;font-size:0.72rem;color:var(--muted);margin-left:8px}

  /* Right column: compact widgets */
  .side{
    display:flex;flex-direction:column;gap:12px;
  }
  .card{
    background:var(--card);border:1px solid var(--border);
    border-radius:var(--radius);padding:12px;box-shadow:var(--shadow);
  }
  .meta{font-size:0.78rem;color:var(--muted);text-align:center}
  .ramadan{
    display:flex;flex-direction:column;gap:6px;align-items:center;
  }
  .ramadan strong{color:var(--accent2);font-size:1.02rem}
  .small{font-size:calc(var(--small));color:var(--muted)}

  /* Calendar minimized: modal style */
  .calendar-trigger{
    width:100%;
    display:flex;gap:8px;
  }
  .btn{
    background:linear-gradient(90deg, rgba(45,212,255,0.06), rgba(0,215,167,0.04));
    color:var(--text);border:1px solid rgba(255,255,255,0.04);
    padding:9px 10px;border-radius:10px;font-weight:600;cursor:pointer;
  }

  /* compact calendar modal */
  .modal{
    position:fixed;inset:0;display:none;align-items:center;justify-content:center;
    background:rgba(0,0,0,0.6);z-index:60;padding:18px;
  }
  .modal.open{display:flex}
  .modal .panel{
    width:760px;max-width:95%;max-height:86vh;overflow:auto;border-radius:12px;
    background:linear-gradient(180deg,var(--card),#050506);border:1px solid var(--border);
    padding:14px;
  }
  .calendar-table{width:100%;border-collapse:collapse;font-size:0.88rem}
  .calendar-table th, .calendar-table td{padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03);text-align:center}
  .cal-today{background:rgba(45,212,255,0.06);font-weight:700;color:var(--accent);}

  /* Footer small */
  footer{grid-column:1 / -1;text-align:center;color:var(--muted);font-size:0.75rem;margin-top:8px}

  /* Responsive: single column on small screens */
  @media (max-width:860px){
    .wrap{grid-template-columns:1fr; padding-bottom:40px}
    .side{order:2}
    .main{order:1}
  }
</style>
</head>
<body>
  <div class="wrap" role="application">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">PT</div>
        <div>
          <h1>Prayer times — Gosheim, Germany</h1>
          <div class="sub" id="gregorian">—</div>
        </div>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div class="sub" id="hijri">Hijri: —</div>
        <div class="meta" id="meta" style="margin-top:6px">Method: Muslim World League • School: Hanafi</div>
      </div>
    </header>

    <!-- Main (left) -->
    <main class="main" aria-live="polite">
      <div class="toprow">
        <div class="next-prayer-card" aria-hidden="false">
          <div class="label">Next prayer</div>
          <div class="next-name" id="nextName">—</div>
          <div class="countdown" id="countdown">—</div>
        </div>

        <div style="width:220px;display:flex;flex-direction:column;gap:8px">
          <div class="date-nav" aria-label="Datum Navigation">
            <button class="icon-btn" id="prevDay" aria-label="Vorheriger Tag">&lt;</button>
            <input type="date" id="dateInput" aria-label="Datum auswählen" />
            <button class="icon-btn" id="nextDay" aria-label="Nächster Tag">&gt;</button>
          </div>

          <div style="display:flex;gap:8px">
            <button class="btn" id="toggleCalendar">Monatskalender</button>
            <button class="btn" id="refreshBtn" title="Refresh">↻</button>
          </div>
        </div>
      </div>

      <section aria-label="Prayer times list" style="overflow:hidden;">
        <table class="prayers" role="table" aria-label="Prayer times">
          <thead>
            <tr><th>Prayer</th><th style="text-align:right">Time</th></tr>
          </thead>
          <tbody id="tableBody">
            <!-- rows inserted here -->
          </tbody>
        </table>
      </section>

      <div id="error" role="alert" style="display:none;color:#ff7a88;background:rgba(255,77,109,0.06);border:1px solid rgba(255,77,109,0.14);padding:8px;border-radius:8px;font-size:0.9rem"></div>
    </main>

    <!-- Side (right) -->
    <aside class="side" aria-hidden="false">
      <div class="card ramadan" role="region" aria-label="Ramadan countdown">
        <div class="small">Days until Ramadan</div>
        <div><strong id="ramadanCountdown">—</strong></div>
        <div class="small" id="ramadanDate">—</div>
      </div>

      <div class="card" role="region" aria-label="Method info">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700">Settings</div>
            <div class="small" style="margin-top:6px">Address: Gosheim • Method: MWL</div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px">
          <select id="methodSelect" aria-label="Method" style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid var(--border);color:var(--text)">
            <option value="3" selected>Muslim World League</option>
            <option value="2">ISNA</option>
            <option value="1">University of Islamic Sciences, Karachi</option>
          </select>
          <select id="schoolSelect" aria-label="School" style="width:88px;padding:8px;border-radius:8px;background:transparent;border:1px solid var(--border);color:var(--text)">
            <option value="1" selected>Hanafi</option>
            <option value="0">Shafi</option>
          </select>
        </div>
      </div>

      <div class="card" style="text-align:center">
        <div class="small">Powered by</div>
        <div style="margin-top:8px;font-weight:700;color:var(--muted)">AlAdhan API</div>
      </div>
    </aside>

    <footer>Compact OLED theme — designed for low glare & comfortable reading</footer>
  </div>

  <!-- Calendar modal -->
  <div class="modal" id="calendarModal" aria-hidden="true" role="dialog" aria-label="Monthly calendar">
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div style="display:flex;gap:8px;align-items:center">
          <select id="monthSelect" aria-label="Monat wählen" style="padding:8px;border-radius:8px;background:transparent;border:1px solid var(--border);color:var(--text)"></select>
          <select id="yearSelect" aria-label="Jahr wählen" style="padding:8px;border-radius:8px;background:transparent;border:1px solid var(--border);color:var(--text)"></select>
          <button class="btn" id="loadCalendar">Load</button>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="closeCal">Close</button>
        </div>
      </div>

      <div style="margin-top:12px;overflow:auto">
        <table class="calendar-table" id="calendarTable" aria-label="Monthly prayer calendar">
          <thead>
            <tr><th>Datum</th><th>Fajr</th><th>Dhuhr</th><th>Asr</th><th>Maghrib</th><th>Isha</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="small" style="margin-top:8px;text-align:center">Zeiten im 24-Stunden-Format — lokale Zeitzone</div>
    </div>
  </div>

<script>
/* Configuration */
const ADDRESS = "Gosheim, Germany";
let METHOD = "3";
let SCHOOL = "1";

/* DOM refs */
const el = {
  tableBody: document.getElementById("tableBody"),
  gregorian: document.getElementById("gregorian"),
  hijri: document.getElementById("hijri"),
  nextName: document.getElementById("nextName"),
  countdown: document.getElementById("countdown"),
  dateInput: document.getElementById("dateInput"),
  ramadanCountdown: document.getElementById("ramadanCountdown"),
  ramadanDate: document.getElementById("ramadanDate"),
  meta: document.getElementById("meta"),
  error: document.getElementById("error"),
  toggleCalendar: document.getElementById("toggleCalendar"),
  calendarModal: document.getElementById("calendarModal"),
  monthSelect: document.getElementById("monthSelect"),
  yearSelect: document.getElementById("yearSelect"),
  loadCalendar: document.getElementById("loadCalendar"),
  calBody: document.querySelector("#calendarTable tbody"),
  prevDay: document.getElementById("prevDay"),
  nextDay: document.getElementById("nextDay"),
  refreshBtn: document.getElementById("refreshBtn"),
  methodSelect: document.getElementById("methodSelect"),
  schoolSelect: document.getElementById("schoolSelect"),
  closeCal: document.getElementById("closeCal")
};

const PRAYER_ORDER = ["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];
const PRAYERS_FOR_STATUS = ["Fajr","Dhuhr","Asr","Maghrib","Isha"];
const MONTHS_DE = ["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"];

function pad(n){ return String(n).padStart(2,"0"); }
function formatAPIDate(d){ return `${pad(d.getDate())}-${pad(d.getMonth()+1)}-${d.getFullYear()}`; }
function formatInputDateISO(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }
function stripTZ(s){ return !s ? "—" : s.split(" ")[0]; }
function toAmPm(t){
  if(!t || t==="—") return "—";
  const [h,m] = t.split(":").map(Number);
  const hh = (h % 12) || 12;
  return hh + ":" + pad(m) + (h >= 12 ? " PM" : " AM");
}
function parseTime(baseDate, timeStr){
  const [h,m] = timeStr.split(":").map(Number);
  const d = new Date(baseDate);
  d.setHours(h, m, 0, 0);
  return d;
}
function hms(ms){
  if(ms < 0) ms = 0;
  const s = Math.floor(ms/1000), h = Math.floor(s/3600), m = Math.floor((s % 3600)/60), sec = s % 60;
  return pad(h) + ":" + pad(m) + ":" + pad(sec);
}
function formatDateGermanLong(d){
  try{
    return d.toLocaleDateString('de-DE', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
  }catch(e){
    return d.toLocaleDateString('de-DE');
  }
}
function formatDateGermanShort(d){
  return pad(d.getDate()) + "." + pad(d.getMonth()+1) + "." + d.getFullYear();
}
function buildRow(name, time24, isCurrent, isNext){
  const tr = document.createElement("tr");
  if(isCurrent) tr.classList.add("current");
  if(isNext) tr.classList.add("next");
  const td1 = document.createElement("td");
  td1.textContent = name;
  const td2 = document.createElement("td");
  td2.style.textAlign = "right";
  td2.innerHTML = `<span class="time">${time24}</span>`;
  if(isCurrent) td2.innerHTML += `<span class="indicator">Current</span>`;
  else if(isNext) td2.innerHTML += `<span class="indicator">Next</span>`;
  tr.append(td1, td2);
  return tr;
}

/* Ramadan widget using AlAdhan conversion */
async function updateRamadanWidget(hijri){
  try{
    const hijriYear = hijri && hijri.year ? parseInt(hijri.year, 10) : (new Date()).getFullYear();
    const currentHijriMonthNum = hijri && hijri.month && hijri.month.number ? parseInt(hijri.month.number,10) : null;
    let targetHijri = hijriYear;
    if(currentHijriMonthNum !== null){
      if(currentHijriMonthNum > 9) targetHijri = hijriYear + 1;
      else if(currentHijriMonthNum === 9 && hijri.day && parseInt(hijri.day,10) > 1) targetHijri = hijriYear + 1;
    }
    const resp = await fetch(`https://api.aladhan.com/v1/hToG?date=1-9-${targetHijri}`);
    const body = await resp.json();
    const g = (body && body.data && body.data.gregorian && body.data.gregorian.date) ? body.data.gregorian.date : null;
    if(!g){
      el.ramadanCountdown.textContent = "—";
      el.ramadanDate.textContent = "Ramadan start date unavailable";
      return;
    }
    const [gd, gm, gy] = g.split("-");
    const ramG = new Date(`${gy}-${gm}-${gd}T00:00:00`);
    const diffDays = Math.ceil((ramG - new Date()) / 86400000);
    el.ramadanCountdown.textContent = diffDays > 0 ? diffDays : diffDays === 0 ? "Heute" : "Bereits begonnen";
    el.ramadanDate.textContent = `Start: ${formatDateGermanShort(ramG)}`;
  }catch(err){
    el.ramadanCountdown.textContent = "—";
    el.ramadanDate.textContent = "Ramadan countdown unavailable";
  }
}

let countdownTimer = null;

async function loadDaily(d){
  try{
    el.error.style.display = "none";
    const apiDate = formatAPIDate(d);
    const url = `https://api.aladhan.com/v1/timingsByAddress/${apiDate}?address=${encodeURIComponent(ADDRESS)}&method=${METHOD}&school=${SCHOOL}`;
    const resp = await fetch(url);
    const body = await resp.json();
    if(!body || !body.data) throw new Error("No data returned from API");
    const data = body.data;
    const timings = data.timings || {};
    const dateInfo = data.date || {};

    // Gregorian display
    if(dateInfo.gregorian && dateInfo.gregorian.day){
      const g = dateInfo.gregorian;
      const gDate = new Date(`${g.year}-${String(g.month.number).padStart(2,'0')}-${String(g.day).padStart(2,'0')}T00:00:00`);
      el.gregorian.textContent = formatDateGermanLong(gDate);
    } else {
      el.gregorian.textContent = dateInfo.readable || "—";
    }

    // Hijri
    const hijri = dateInfo.hijri || {};
    el.hijri.textContent = hijri && hijri.month ? `Hijri: ${hijri.day} ${hijri.month.en} ${hijri.year}` : "Hijri: —";

    // Map times
    const tMap = {};
    PRAYER_ORDER.forEach(p => {
      const t = stripTZ(timings[p]);
      if(t !== "—") tMap[p] = parseTime(d, t);
    });

    const now = new Date();
    let currentName = null, nextName = null;

    for(const p of PRAYERS_FOR_STATUS){
      const t = tMap[p];
      if(!t) continue;
      if(now >= t) currentName = p;
      else if(!nextName) nextName = p;
    }

    // if no next, get tomorrow's fajr
    let nextIsTomorrow = false;
    if(!nextName){
      const tomorrow = new Date(d);
      tomorrow.setDate(tomorrow.getDate() + 1);
      const resp2 = await fetch(`https://api.aladhan.com/v1/timingsByAddress/${formatAPIDate(tomorrow)}?address=${encodeURIComponent(ADDRESS)}&method=${METHOD}&school=${SCHOOL}`);
      const body2 = await resp2.json();
      const t2 = body2 && body2.data && body2.data.timings && stripTZ(body2.data.timings.Fajr);
      if(t2 && t2 !== "—"){
        nextName = "Fajr";
        nextIsTomorrow = true;
        tMap["Fajr_tomorrow"] = parseTime(tomorrow, t2);
      }
    }

    // Render rows (compact)
    el.tableBody.innerHTML = "";
    PRAYER_ORDER.forEach(p => {
      const raw = stripTZ(timings[p]);
      if(raw === "—") return;
      const display = raw; // keep 24h compact
      const isCurrent = p === currentName;
      const isNext = p === nextName;
      el.tableBody.appendChild(buildRow(p, display, isCurrent, isNext));
    });

    // Countdown
    if(countdownTimer) clearInterval(countdownTimer);
    if(nextName){
      el.nextName.textContent = nextIsTomorrow ? `${nextName} (tomorrow)` : nextName;
      const targetTime = nextIsTomorrow ? tMap["Fajr_tomorrow"] : tMap[nextName];
      const tick = () => {
        const diff = targetTime - new Date();
        el.countdown.textContent = hms(diff);
      };
      tick();
      countdownTimer = setInterval(tick, 1000);
    } else {
      el.nextName.textContent = "—";
      el.countdown.textContent = "—";
    }

    el.meta.textContent = `Method: ${methodLabel(METHOD)} • School: ${SCHOOL === "1" ? "Hanafi" : "Shafi"}`;
    updateRamadanWidget(hijri);
  }catch(e){
    el.error.textContent = `Could not load timings. ${e.message || e}`;
    el.error.style.display = "block";
    el.tableBody.innerHTML = "";
    el.nextName.textContent = "—";
    el.countdown.textContent = "—";
  }
}

function methodLabel(id){
  const map = {"3":"Muslim World League","2":"ISNA","1":"University of Islamic Sciences, Karachi"};
  return map[id] || "Custom";
}

/* Monthly calendar */
function populateMonthYearSelectors(){
  const now = new Date();
  MONTHS_DE.forEach((name, i) => {
    const opt = document.createElement("option");
    opt.value = i + 1;
    opt.textContent = name;
    if(i === now.getMonth()) opt.selected = true;
    el.monthSelect.appendChild(opt);
  });
  for(let y = now.getFullYear() - 1; y <= now.getFullYear() + 1; y++){
    const opt = document.createElement("option");
    opt.value = y;
    opt.textContent = y;
    if(y === now.getFullYear()) opt.selected = true;
    el.yearSelect.appendChild(opt);
  }
}

async function loadMonthlyData(month, year){
  try{
    el.calBody.innerHTML = `<tr><td colspan="6" style="padding:12px;text-align:center;color:${getComputedStyle(document.documentElement).getPropertyValue('--muted')}">Loading…</td></tr>`;
    const r = await fetch(`https://api.aladhan.com/v1/calendarByAddress?address=${encodeURIComponent(ADDRESS)}&method=${METHOD}&school=${SCHOOL}&month=${month}&year=${year}`);
    const body = await r.json();
    const days = body && body.data ? body.data : [];
    el.calBody.innerHTML = "";
    const today = new Date();
    days.forEach(day => {
      const tr = document.createElement("tr");
      const gr = day.date.gregorian;
      const grDate = new Date(`${gr.year}-${String(gr.month.number).padStart(2,'0')}-${String(gr.day).padStart(2,'0')}T00:00:00`);
      if(gr.day == today.getDate() && gr.month.number == today.getMonth() + 1 && gr.year == today.getFullYear()) tr.classList.add("cal-today");
      const t = day.timings || {};
      const cells = [
        formatDateGermanShort(grDate),
        stripTZ(t.Fajr),
        stripTZ(t.Dhuhr),
        stripTZ(t.Asr),
        stripTZ(t.Maghrib),
        stripTZ(t.Isha)
      ];
      cells.forEach(c => {
        const td = document.createElement("td");
        td.textContent = c;
        tr.appendChild(td);
      });
      el.calBody.appendChild(tr);
    });
    if(days.length === 0){
      el.calBody.innerHTML = `<tr><td colspan="6" style="padding:12px;text-align:center;color:${getComputedStyle(document.documentElement).getPropertyValue('--muted')}">Monthly calendar unavailable</td></tr>`;
    }
  }catch(err){
    el.calBody.innerHTML = `<tr><td colspan="6" style="padding:12px;text-align:center;color:${getComputedStyle(document.documentElement).getPropertyValue('--muted')}">Monthly calendar unavailable</td></tr>`;
  }
}

/* Events */
el.toggleCalendar.addEventListener("click", ()=> {
  el.calendarModal.classList.add("open");
  el.calendarModal.setAttribute("aria-hidden","false");
});
el.closeCal.addEventListener("click", ()=> {
  el.calendarModal.classList.remove("open");
  el.calendarModal.setAttribute("aria-hidden","true");
});
el.loadCalendar.addEventListener("click", ()=> {
  loadMonthlyData(parseInt(el.monthSelect.value,10), parseInt(el.yearSelect.value,10));
});
el.prevDay.addEventListener("click", ()=> {
  if(!el.dateInput.value) return;
  const d = new Date(el.dateInput.value + "T00:00:00");
  d.setDate(d.getDate() - 1);
  el.dateInput.value = formatInputDateISO(d);
  loadDaily(d);
});
el.nextDay.addEventListener("click", ()=> {
  if(!el.dateInput.value) return;
  const d = new Date(el.dateInput.value + "T00:00:00");
  d.setDate(d.getDate() + 1);
  el.dateInput.value = formatInputDateISO(d);
  loadDaily(d);
});
el.dateInput.addEventListener("change", ()=> {
  if(el.dateInput.value) loadDaily(new Date(el.dateInput.value + "T00:00:00"));
});
el.refreshBtn.addEventListener("click", ()=> {
  const d = el.dateInput.value ? new Date(el.dateInput.value + "T00:00:00") : new Date();
  loadDaily(d);
});
el.methodSelect.addEventListener("change", (e)=> {
  METHOD = e.target.value;
  const d = el.dateInput.value ? new Date(el.dateInput.value + "T00:00:00") : new Date();
  loadDaily(d);
  // reload calendar if open
  if(el.calendarModal.classList.contains("open")) loadMonthlyData(parseInt(el.monthSelect.value,10), parseInt(el.yearSelect.value,10));
});
el.schoolSelect.addEventListener("change",(e)=> {
  SCHOOL = e.target.value;
  const d = el.dateInput.value ? new Date(el.dateInput.value + "T00:00:00") : new Date();
  loadDaily(d);
});

/* Init */
(function init(){
  populateMonthYearSelectors();
  const today = new Date();
  el.dateInput.value = formatInputDateISO(today);
  loadDaily(today);
  loadMonthlyData(today.getMonth() + 1, today.getFullYear());
})();
</script>
</body>
</html>
