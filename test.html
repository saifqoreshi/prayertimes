<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prayer Times – Gosheim, Germany</title>
<style>
:root {
  --bg: #0b0f14;
  --card: #111722;
  --text: #e6edf3;
  --muted: #9fb0c0;
  --accent: #3aaaff;
  --current: #ff6b6b;
  --next: #3aaaff;
  --today: #3aaaff;
  --weekend: #2a2f3b;
}

body {
  margin: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: var(--bg);
  color: var(--text);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1rem;
}

h1 {
  text-align: center;
  margin-bottom: 1rem;
  font-size: 1.5rem;
}

.card {
  background-color: var(--card);
  border-radius: 1rem;
  padding: 1rem;
  width: 100%;
  max-width: 450px;
  margin-bottom: 1rem;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

.prayer-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.prayer-item {
  display: flex;
  justify-content: space-between;
  padding: 0.6rem 1rem;
  border-radius: 0.5rem;
  background-color: #1a1f2b;
  transition: background 0.3s;
}

.prayer-item.current {
  background-color: var(--current);
  font-weight: bold;
  color: #fff;
}

.prayer-item.next {
  background-color: var(--next);
  font-weight: bold;
  color: #fff;
}

.countdown {
  text-align: center;
  font-size: 1.2rem;
  margin-top: 0.8rem;
  color: var(--accent);
}

.footer {
  font-size: 0.75rem;
  color: var(--muted);
  margin-top: 1rem;
  text-align: center;
}

button, input, select {
  padding: 0.3rem 0.6rem;
  border-radius: 0.5rem;
  border: none;
  margin: 0 0.2rem;
  font-size: 0.9rem;
}

button {
  background-color: var(--accent);
  color: #fff;
  cursor: pointer;
}

.monthly-card {
  background-color: var(--card);
  border-radius: 1rem;
  padding: 0.8rem;
  width: 100%;
  max-width: 450px;
  margin-bottom: 1rem;
  display: none;
  flex-direction: column;
  gap: 0.5rem;
}

.monthly-controls {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.3rem;
  margin-bottom: 0.5rem;
}

.monthly-table {
  display: flex;
  flex-direction: column;
  gap: 0.2rem;
  max-height: 350px;
  overflow-y: auto;
}

.monthly-row {
  display: flex;
  justify-content: space-between;
  background-color: #1a1f2b;
  border-radius: 0.4rem;
  padding: 0.3rem 0.6rem;
  font-size: 0.85rem;
}

.monthly-row.today {
  background-color: var(--today);
  color: #fff;
  font-weight: bold;
}

.monthly-row.weekend {
  background-color: var(--weekend);
}

.legend {
  font-size: 0.75rem;
  color: var(--muted);
  text-align: center;
}

.toggle-btn {
  margin-bottom: 0.5rem;
  background-color: var(--accent);
  color: #fff;
  cursor: pointer;
}

@media (max-width: 400px) {
  h1 { font-size: 1.3rem; }
  .countdown { font-size: 1rem; }
}
</style>
</head>
<body>

<h1>Prayer Times – Gosheim, Germany</h1>

<!-- Date navigation for main table -->
<div style="margin-bottom:0.5rem; display:flex; align-items:center; gap:0.3rem; flex-wrap:wrap;">
  <button onclick="prevDay()">Prev</button>
  <input type="date" id="main-date" onchange="fetchPrayerTimesForDate()">
  <button onclick="nextDay()">Next</button>
  <button onclick="goToday()">Today</button>
</div>

<div class="card">
  <div class="prayer-list">
    <div class="prayer-item" id="fajr-row">Fajr <span id="fajr">—</span></div>
    <div class="prayer-item" id="dhuhr-row">Dhuhr <span id="dhuhr">—</span></div>
    <div class="prayer-item" id="asr-row">Asr <span id="asr">—</span></div>
    <div class="prayer-item" id="maghrib-row">Maghrib <span id="maghrib">—</span></div>
    <div class="prayer-item" id="isha-row">Isha <span id="isha">—</span></div>
  </div>
  <div class="countdown" id="next-prayer">Next prayer in —</div>
</div>

<!-- Monthly calendar toggle -->
<button class="toggle-btn" onclick="toggleMonthly()">Show/Hide Monthly Calendar</button>

<div class="monthly-card" id="monthly-card">
  <div class="monthly-controls">
    <select id="month-select" onchange="fetchMonthly()"></select>
    <select id="year-select" onchange="fetchMonthly()"></select>
  </div>
  <div class="monthly-table" id="monthly-table"></div>
  <div class="legend">Times in 12-hour format, no AM/PM shown, no timezone info.</div>
</div>

<div class="footer">
  Powered by AlAdhan API • Method: Muslim World League • School: Hanafi
</div>

<script>
const city = "Gosheim";
const country = "Germany";
const method = 3;
const prayerIds = ["fajr","dhuhr","asr","maghrib","isha"];
const prayerRows = {
  fajr: document.getElementById("fajr-row"),
  dhuhr: document.getElementById("dhuhr-row"),
  asr: document.getElementById("asr-row"),
  maghrib: document.getElementById("maghrib-row"),
  isha: document.getElementById("isha-row"),
};

// Main table date navigation
let mainDate = new Date();
const mainDateInput = document.getElementById("main-date");
mainDateInput.value = mainDate.toISOString().split("T")[0];

function prevDay(){ mainDate.setDate(mainDate.getDate()-1); updateMainDate(); fetchPrayerTimesForDate();}
function nextDay(){ mainDate.setDate(mainDate.getDate()+1); updateMainDate(); fetchPrayerTimesForDate();}
function goToday(){ mainDate = new Date(); updateMainDate(); fetchPrayerTimesForDate();}
function updateMainDate(){ mainDateInput.value = mainDate.toISOString().split("T")[0];}
mainDateInput.addEventListener("change",()=>{ mainDate = new Date(mainDateInput.value); fetchPrayerTimesForDate(); });

// Convert 24h -> 12h with AM/PM
function to12HourAMPM(timeStr){
  let [h,m] = timeStr.split(":").map(Number);
  const ampm = h<12?"AM":"PM";
  h=h%12||12;
  return `${h}:${m.toString().padStart(2,"0")} ${ampm}`;
}

// Convert 24h -> 12h for monthly table (no AM/PM)
function to12Hour(timeStr){
  let [h,m] = timeStr.split(":").map(Number);
  h = h%12||12;
  return `${h}:${m.toString().padStart(2,"0")}`;
}

// Fetch prayer times for main table
let timings = {};
function fetchPrayerTimesForDate(){
  const dateStr = `${mainDate.getDate().toString().padStart(2,"0")}-${(mainDate.getMonth()+1).toString().padStart(2,"0")}-${mainDate.getFullYear()}`;
  fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=${method}&date=${dateStr}`)
  .then(res=>res.json())
  .then(data=>{
    timings={};
    prayerIds.forEach(p=>{
      const t24 = data.data.timings[p.charAt(0).toUpperCase()+p.slice(1)];
      timings[p]=t24;
      document.getElementById(p).textContent=to12HourAMPM(t24);
    });
    updateCountdown();
  });
}

// Countdown and highlight current/next prayer
function updateCountdown(){
  const now = new Date();
  const todayStr = mainDate.toISOString().split("T")[0];
  let nextPrayer=null,currentPrayer=null,nextTime=null;

  for(let p of prayerIds){
    const tStr = `${mainDate.getFullYear()}-${(mainDate.getMonth()+1).toString().padStart(2,"0")}-${mainDate.getDate().toString().padStart(2,"0")}T${timings[p]}:00`;
    const t = new Date(tStr);
    if(now>=t) currentPrayer=p;
    if(t>now && !nextPrayer){ nextPrayer=p; nextTime=t; }
  }

  if(!nextPrayer){ // next day Fajr
    const tomorrow = new Date(mainDate);
    tomorrow.setDate(mainDate.getDate()+1);
    nextPrayer="fajr";
    nextTime = new Date(`${tomorrow.getFullYear()}-${(tomorrow.getMonth()+1).toString().padStart(2,"0")}-${tomorrow.getDate().toString().padStart(2,"0")}T${timings.fajr}:00`);
  }

  prayerIds.forEach(p=>{prayerRows[p].classList.remove("current","next");});
  if(currentPrayer) prayerRows[currentPrayer].classList.add("current");
  if(nextPrayer) prayerRows[nextPrayer].classList.add("next");

  const diff = nextTime-now;
  const h = Math.floor(diff/1000/60/60);
  const m = Math.floor((diff/1000/60)%60);
  const s = Math.floor((diff/1000)%60);
  document.getElementById("next-prayer").textContent=
    `Next prayer (${nextPrayer.charAt(0).toUpperCase()+nextPrayer.slice(1)}) in ${h}h ${m}m ${s}s`;
}

setInterval(updateCountdown,1000);
fetchPrayerTimesForDate();

// Monthly calendar
const monthlyCard = document.getElementById("monthly-card");
function toggleMonthly(){ monthlyCard.style.display = monthlyCard.style.display==="flex"?"none":"flex"; if(monthlyCard.style.display==="flex") fetchMonthly(); }

const monthSelect = document.getElementById("month-select");
const yearSelect = document.getElementById("year-select");
const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
months.forEach((m,i)=>{ const opt=document.createElement("option"); opt.value=i; opt.text=m; monthSelect.add(opt); });
const currentYear = new Date().getFullYear();
for(let y=currentYear-2;y<=currentYear+2;y++){ const opt=document.createElement("option"); opt.value=y; opt.text=y; yearSelect.add(opt); }
monthSelect.value = mainDate.getMonth();
yearSelect.value = mainDate.getFullYear();

function fetchMonthly(){
  const month = parseInt(monthSelect.value);
  const year = parseInt(yearSelect.value);
  const tableEl = document.getElementById("monthly-table");
  tableEl.innerHTML="";
  const daysInMonth = new Date(year, month+1, 0).getDate();
  const today = new Date();
  
  const promises = [];
  for(let d=1; d<=daysInMonth; d++){
    const dateObj = new Date(year, month, d);
    const dayOfWeek = dateObj.getDay(); // 0=Sunday,6=Saturday
    const isWeekend = dayOfWeek===0 || dayOfWeek===6;
    const isToday = today.getFullYear()===year && today.getMonth()===month && today.getDate()===d;
    
    const dateStr = `${d.toString().padStart(2,"0")}-${(month+1).toString().padStart(2,"0")}-${year}`;
    promises.push(
      fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=${method}&date=${dateStr}`)
      .then(res=>res.json())
      .then(data=>{
        const row = document.createElement("div");
        row.className = "monthly-row";
        if(isToday) row.classList.add("today");
        if(isWeekend) row.classList.add("weekend");
        const t = data.data.timings;
        row.innerHTML = `${dateStr} - ${prayerIds.map(p=>to12Hour(t[p.charAt(0).toUpperCase()+p.slice(1)])).join(" | ")}`;
        tableEl.appendChild(row);
      })
    );
  }
  Promise.all(promises);
}
</script>

</body>
</html>
